<div id="image-viewer" class="image-viewer">
    <div class="viewer-backdrop"></div>

    <!-- Viewer controls -->
    <div class="viewer-controls">
        <button id="fullscreen-toggle" class="viewer-control-btn" title="Fullscreen (F)">
            <svg class="fullscreen-enter" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>
            <svg class="fullscreen-exit" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>
        </button>
        <button id="close-viewer" class="viewer-control-btn" title="Close (Esc)">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>

    <!-- Main viewer layout -->
    <div class="viewer-layout">
        <!-- Media container -->
        <div class="viewer-media-section">
            <!-- Navigation buttons -->
            <button id="prev-image" class="viewer-nav viewer-nav-prev" title="Previous (←)">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
            </button>

            <div class="viewer-media-container">
                <img id="viewer-image" src="" alt="Full size image">
                <video id="viewer-video" muted loop playsinline></video>
            </div>

            <button id="next-image" class="viewer-nav viewer-nav-next" title="Next (→)">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
            </button>

            <!-- Image counter -->
            <div class="viewer-counter">
                <span id="viewer-current">1</span> / <span id="viewer-total">1</span>
            </div>
        </div>

        <!-- Info panel -->
        <aside class="viewer-info-panel">
            <div class="viewer-panel-header">
                <h3>Image Details</h3>
                <div class="viewer-panel-actions">
                    <button id="copy-all-metadata" class="panel-action-btn" title="Copy all metadata">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    </button>
                </div>
            </div>

            <div class="viewer-panel-content">
                <!-- Positive Prompt -->
                <div class="prompt-section">
                    <div class="prompt-header">
                        <h4>Positive Prompt</h4>
                        <button class="copy-button" data-target="positive-prompt" title="Copy">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                    <div id="positive-prompt" class="prompt"></div>
                </div>

                <!-- Negative Prompt -->
                <div class="prompt-section">
                    <div class="prompt-header">
                        <h4>Negative Prompt</h4>
                        <button class="copy-button" data-target="negative-prompt" title="Copy">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                    <div id="negative-prompt" class="prompt"></div>
                </div>

                <!-- Generation Settings -->
                <div class="settings-section">
                    <h4>Generation Settings</h4>
                    <div id="additional-info" class="settings-grid"></div>
                </div>
            </div>

            <!-- Keyboard shortcuts hint -->
            <div class="viewer-shortcuts">
                <span><kbd>←</kbd><kbd>→</kbd> Navigate</span>
                <span><kbd>F</kbd> Fullscreen</span>
                <span><kbd>Esc</kbd> Close</span>
            </div>
        </aside>
    </div>

    <!-- Thumbnail strip -->
    <div class="viewer-thumbnails">
        <div id="thumbnail-strip" class="thumbnail-strip">
            <!-- Thumbnails will be populated by JS -->
        </div>
    </div>
</div>

<!-- Hidden div containing the encoded image data with UTF-8 support -->
<div id="images-data" style="display: none;" data-images="{{ images_encoded|e }}"></div>
